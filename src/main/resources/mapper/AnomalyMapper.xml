<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.roymark.queue.dao.AnomalyMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.roymark.queue.entity.Anomaly">
        <id column="anomaly_hidden_id" property="anomalyHiddenId" />
        <result column="anomaly_event" property="anomalyEvent" />
        <result column="anomaly_start_date" property="anomalyStartDate" />
        <result column="anomaly_end_date" property="anomalyEndDate" />
        <result column="anomaly_confidence" property="anomalyConfidence" />
        <result column="anomaly_video_path" property="anomalyVideoPath" />
        <result column="anomaly_image_path" property="anomalyImagePath" />
        <result column="cam_hidden_id" property="camHiddenId" />
        <result column="window_hidden_id" property="windowHiddenId" />
        <result column="user_hidden_id" property="userHiddenId" />
        <result column="anomaly_status" property="anomalyStatus" />
        <result column="window_id" property="windowId" />
        <result column="window_name" property="windowName" />
        <result column="user_name" property="userName" />
        <collection property="userIds" ofType="java.lang.Long" javaType="java.util.List">
            <result column="uid" />
        </collection>
        <collection property="userNames" ofType="java.lang.String" javaType="java.util.List">
            <result column="uname" />
        </collection>
        <collection property="faceConfs" ofType="java.lang.Double" javaType="java.util.List">
            <result column="fc" />
        </collection>
    </resultMap>

    <!-- 通用查询结果列 -->
    <select id="getAllAnomaly" resultMap="BaseResultMap">
        SELECT br_anomaly.*, br_anomaly_user.face_conf as fc, br_user.user_hidden_id as uid, br_user.user_name as uname, br_window.window_id, br_window.window_name FROM br_anomaly
            LEFT JOIN br_window ON br_anomaly.window_hidden_id=br_window.window_hidden_id
            LEFT JOIN br_anomaly_user ON br_anomaly.anomaly_hidden_id=br_anomaly_user.anomaly_hidden_id
            LEFT JOIN br_user ON br_anomaly_user.user_hidden_id=br_user.user_hidden_id
    </select>

    <select id="getAnomalyByHiddenId" parameterType="long" resultMap="BaseResultMap">
        SELECT br_anomaly.*, br_anomaly_user.face_conf as fc, br_user.user_hidden_id as uid, br_user.user_name as uname, br_window.window_id, br_window.window_name FROM br_anomaly
            LEFT JOIN br_window ON br_anomaly.window_hidden_id=br_window.window_hidden_id
            LEFT JOIN br_anomaly_user ON br_anomaly.anomaly_hidden_id=br_anomaly_user.anomaly_hidden_id
            LEFT JOIN br_user ON br_anomaly_user.user_hidden_id=br_user.user_hidden_id
        WHERE br_anomaly.anomaly_hidden_id=#{VALUE }
    </select>

    <select id="page" resultMap="BaseResultMap">
        SELECT br_anomaly.*, br_anomaly_user.face_conf as fc, br_user.user_hidden_id as uid, br_user.user_name as uname, br_window.window_id, br_window.window_name FROM br_anomaly
           LEFT JOIN br_window ON br_anomaly.window_hidden_id=br_window.window_hidden_id
           LEFT JOIN br_anomaly_user ON br_anomaly.anomaly_hidden_id=br_anomaly_user.anomaly_hidden_id
           LEFT JOIN br_user ON br_anomaly_user.user_hidden_id=br_user.user_hidden_id
        ${ew.customSqlSegment}
    </select>

</mapper>
